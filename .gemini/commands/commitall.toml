description = "Dynamic pre-commit and commit workflow for all active repositories."
prompt = """
Perform a comprehensive commit and push workflow for all active git repositories in the current workspace.

## 1. Discovery & Status Check
Run `consult workspace` to analyze the status, classification, and identity of all repositories in the current context.

**Analyze the Output:**
*   **Active Repos:** Any repo marked as `Dirty`, `Ahead`, `Diverged`, `Not Backed Up`, or `Outdated Backup`.
*   **Identity Check:** If any Active repo has `Identity` = `?` or `Confidence` = `None`/`Low`, **STOP** and ask the user for clarification before proceeding.

## 2. Execution Pipeline
Process each **Active** repository based on its `Class` from the workspace table.

**Universal Step:** If a remote exists (Class is `Public` or `Private`), always run `git pull --rebase` before committing.

### A. Public Repositories (Class: `Public`)
1.  **Sync:** `git pull --rebase`.
2.  **Verify & Scan:** Run `pytest` (or relevant test command) and `consult precommit`.
    *   **STOP** immediately if any check fails.
3.  **Commit:** Create a clean, product-focused commit message using the detected `Identity` email.
4.  **Push:** Push to origin.

### B. Private & Local-Only Repositories (Class: `Private`, `Local-Only`)
1.  **Sync:** `git pull --rebase` (if Class is `Private` / has remote).
2.  **Commit:** Create a commit using the detected `Identity` email.
    *   **SKIP** `consult precommit` and tests for these repositories unless explicitly requested.
3.  **Backup:**
    *   **Class `Private`:** Push to remote.
    *   **Class `Local-Only`:** Run `consult backup local-repo`.

## Final Report
At the end, provide a structured execution report.
*   One table per processed repository.
*   **Columns:** `Repo` | `Step` | `Status` | `Details`
"""